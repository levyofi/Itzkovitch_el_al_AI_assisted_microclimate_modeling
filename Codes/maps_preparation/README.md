# Map Generation

This folder contains the code used to create the input maps for the physical and machine-learning models. The preparation process consists of four stages:

1. correcting thermal map due to Manufacturer's instructions.
2. Generating five random maps from each flight.
3. Generating height maps.
4. Generating solar, TGI, shade, and skyview maps.
5. Cropping the maps from 1100x1100 pixels to 1024x1024 pixels.

## Stage 1 - Correcting IR map
The code `IR_map_correction.R` corrects the IR map in a value represents the distance between the station and the IR-pixel at the exact same location.

## Stage 2 - Generating Five Random Maps
The code in `main.py` generates random 1100x1100-pixel maps for RGB, the Digital Surface Model (DSM), and ground temperature (IR).

The code reads the original maps from Pix4DMapper and saves the output maps in a folder named after the flight. For example, in this repository, the maps are saved in `Example data/Input data/Zeelim_31.05.21_1516`. The code uses the table in `Example data/Input data/flights_info_final.csv` to locate the original RGB, DSM, and IR maps on our server.

More detailed information and usage instructions can be found in `Resampling Usage.md`.

## Stage 3 - Generating Height Maps
For each flight, the code in `create_height_maps.R` reads the Digital Terrain Model (DTM) map generated by Pix4DMapper and calculates a height map for each DSM random map. The results are saved in `Example data/Input data/Zeelim_31.05.21_1516`.

## Stage 4 - Generating Solar, TGI, Shade, and Skyview Maps
For each flight, the code in `create_physical_features_maps.R` reads the DSM and RGB maps and uses GRASS GIS commands to generate the maps required for the physical model. The results are saved in `Example data/Input data/Zeelim_31.05.21_1516`.

## Stage 5 - Cropping the Maps to 1024x1024 Pixels
For each flight, the code in `crop_maps.R` processes each map generated in the previous steps and crops each raster to 1024x1024 pixels. This step is necessary because the results of Step 3 may be inaccurate at the margins, especially for maps where neighboring pixels are considered (e.g., skyview). 

The cropped maps are saved in a folder named "cropped_" followed by the flight name. For example, the results in this repository are saved in `Example data/Input data/cropped_Zeelim_31.05.21_1516`.
